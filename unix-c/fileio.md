# 文件IO

UNIX的文件IO常被称为不带缓冲的IO，与之相对应的是标准IO，不带缓冲不是指不经过缓存区，而是说每一个read和write都调用内核中的系统调用，对于内核而言，所有打开的文件都通过文件描述符引用，文件描述符是一个非负整数，没打开或者创建一个文件，内核就会返回一个文件描述符，后续的操作都需要使用这个描述符来标记文件。

####打开文件
```
#include<fcntl.h>

int open(const char *path, int oflag, .../*mode_t mode*/);
int openat(int fd, const char *path, int oflag, .../*mode_t mode*/);
//两函数的返回值，成功返回文件描述符的值，错误返回－1
```    
fd参数把openat和open区别开来     
- 当path是绝对路径名的时候，open等于openat。
- 当path是相对路径名的时候，fd指出来相对路径名在文件系统中的开始位置，其中fd通过打开相对路径名所在的路径来获取。
- 当path是相对路径名，fd的值是特殊值AT_FDCWD时，路径名在当前工作目录中获取。

openat主要是为了解决两个问题，第一个问题是让线程可以使用相对路径来打开文件，而不再只能打开当前工作目录，同一进程的线程共享同一个工作目录，很难让他们工作在不同的目录中，如果要用绝对路径的话，使用上又会受到很多限制。第二个问题是解决TOCTTOU(time-of-check-to-time-of-use)问题，提高程序的安全性。   
当文件名或路径名超出了系统规定的最大长度时，是截断还是返回出错由常量_POSIX_NO_TRIUNC决定。

---
百日践行第3天